from flask import json
import pytest 
import time
import sys
import os
import uuid
from rdflib import Graph, Namespace
import logging

# the possible column names of (genes, log fold changes, p-values) used in headers in the imported data files
# most preferred match given first.
possible_gene_names = ['ensembl', 'geneid', 'symbol', 'genesymbol', 'genename', 'entrez', 'ncbi', 'gene', 'tf', 'rna', 'feature']
possible_lfc_names = ['log2', 'lf2', 'lfc2', 'logfold2', 'log2fc', 'logfoldchange', 'logfold', 'lf', 'logfc', 'foldchange', 'fc', 'lfc', 'fold', 'expression', 'enrichment', 'estimate']
possible_pval_names = ['padj', 'adjp', 'pvalueadj', 'adjpvalue', 'pvaladj', 'adjpval', 'pvadj', 'adjpv', 'fdr', 'fdrpval', 'qvalue', 'pvalue', 'qval', 'pval', 'pv', 'qv']

# this is a code snippet generated by gemini
def find_first_match(precedence_list:list[str], names_to_check:list[str]) -> str|None:
    """
    Finds the first item from the precedence_list that exists in the names_to_check list.

    Args:
        precedence_list (list): A list of items in order of priority.
        names_to_check (list): A list of items to search within.

    Returns:
        str: The first matching item found, or None if no match is found.
    """
    # For fast lookups, convert the list of names to check into a set.
    # Checking for an item in a set is much faster than in a list.
    names_set = set(names_to_check)
    
    # Iterate through the precedence list in its given order.
    for name in precedence_list:
        # Check if the current name from the priority list exists in our set.
        if name in names_set:
            # If it exists, we've found our first match. Return it immediately.
            return name
            
    # If the loop completes without finding any matches, return None.
    return None

def test_find_no_match():
    """
    Test case for find_first_match with no available names matching.
    """
    available_names_no_match = ['GENE_A', 'GENE_B', 'GENE_C']
    no_match_result = find_first_match(possible_gene_names, available_names_no_match)
    assert not no_match_result

def test_find_first_match():
    """
    Test case for find_first_match basic use
    """
    available_names_precedence = ['TP53', 'ensembl', 'EGFR']
    first_match_result = find_first_match(possible_gene_names, available_names_precedence)
    assert first_match_result == 'ensembl'


def test_find_first_match_precedence():
    """
    Test case for find_first_match, actually check the precedence is followed
    """
    available_names_match = ['GENE_A', 'geneid', 'ensembl', 'EGFR']
    first_match_result = find_first_match(possible_gene_names, available_names_match)
    assert first_match_result == 'ensembl'


# Set up logging
def akg_logging_config(filename:str):
    """
    Simple shared logging configuration for functions in this project. Log messages will be
    timestamped and at the common level defined below.
    Note this configuration also includes append mode, so repeat invocations will not overwrite the log file.
    Because the data is timestamped, data will not be lost but the file may grow large.
    In AKG each separate program has a separate log file including the program name in the filename.

    Parameters:
        filename (str): The name of the log file to create.
    Returns:
        None
    
    To use this:
    import logging
    from akg import akg_logging_config
    akg_logging_config('file_name_here.log')

    Then from within a function, use:
    logging.info("info text")
    logging.error("error text")
    logging.warning("warning text")
    logging.debug("debug text")
    
    Invoking through 'logging' uses the singleton instance of the logging module, so it is not necessary to pass the logger around, 
    and the same log file will be found by logging calls in other functions once akg_logging_config has been called during that 
    run of the program.
    """
    logging.basicConfig(level=logging.INFO, filename=filename, filemode='a',
                        format='%(asctime)s - %(levelname)s - %(message)s')
    logging.info("AKG logging started")

class AKGException(Exception):
    """
    Custom exception for naming runtime error conditions that are detected and handled by this code
    Simple text-only message, using the base class.

    Usage:
        raise AKGException("Something wrong happened")
    """
    # no actual implementation needed: the type of this class is all that is needed to recognise and use it
    pass

def get_gene_id(gene_name) -> str:
    """retrieves relevant HGNC gene if from file gene_ids.txt.
    Currently removes extra transcript info for simplicity - can be added back in in future trials
    """
    # Remove 'hp_' and variant info to help matching process
    if gene_name.startswith('hp_'):
        gene_name = gene_name[3:]
    if '_' in gene_name[-5:]:
        gene_name = gene_name[:gene_name.rfind('_', len(gene_name) - 5)]    
    if '.' in gene_name:
        gene_name = gene_name.split('.')[0]
    genefile = 'gene_ids.txt'
    #print(f"Searching for gene: {gene_name}")
    with open(genefile, 'r') as file:
        next(file)  
        for line in file:
            if gene_name.upper() in line.upper():
                #print(f"{gene_name} HGNC ID found")
                return line.split('\t')[0]
    #print(f"HGNC ID not found for {gene_name}")
    return ''

class FilenameUUIDMap:
    """
    store persistent UUIDs for filenames
    Example:
        my_map = FilenameUUIDMap()
        uuid = my_map.get_uuid('example.txt')
    """
    def __init__(self, filename='filename_uuid_map.json'):
        self.filename = filename
        self.map = {}
        try:
            with open(self.filename, 'r') as f:
                self.map = json.load(f)
            # create the reverse lookup too
            self.update_reverse_map()
        except FileNotFoundError:
            self.map = {}
        except json.JSONDecodeError:
            print(f"Error decoding JSON from {self.filename}, starting with an empty map")
    def update_reverse_map(self):
        """ 
        Update the reverse map from the main map.
        """
        self.reverse_map = {v: k for k, v in self.map.items()}
    def get_uuid(self, filename):
        """
        Get the UUID for a given filename, or create a new one if it doesn't exist.
        """
        if filename not in self.map:
            self.map[filename] = str(uuid.uuid4())
            self.update_reverse_map
            self.save()
        return self.map[filename]
    def get_filename_from_uuid(self, uuid):
        """
        Get the filename for a given UUID.
        """
        return self.reverse_map.get(uuid, None)

    def save(self):
        """
        Save the current map to the JSON file.
        """
        with open(self.filename, 'w') as f:
            json.dump(self.map, f)

class GeneIdStore:
    """
    Store of gene IDs in multiple formats. For searching.
    Work in progress. This originally used the file lookup method, based on TH's implementation. 
    Extending her file didn't seem to make much improvement, so I downloaded the entire HGNC JSON dataset 
    and implemented a separate lookup based on that. Both methods currently running in series, but still many ensembl IDs are not found
    For those that I've traced further through the ensembl website, they are typically flagged as deprecated. For example, 
    "Ensembl gene ENSG00000183941 is no longer in the database but it has been mapped to 1 deprecated identifier."
    One optimisation of the graph might be simply to apply strict criteria for inclusion - i.e., must have a valid HGNC ID. This might make it 
    more sparse. At the moment the graph includes these with their ensembl IDs.
    """
    def __init__(self, source:str="gene_ids.txt", hgnc_file:str="hgnc_complete_set.json"):
        # create a dict for lookup of ensemble IDs, mapping back to HGNC IDs.
        # create a separate one for other types
        # this is an optimisation
        self._ens:dict[str,str] = {}
        self._oth:dict[str,str] = {}

        self._setup_hgnc_mapping(hgnc_file)

        # Assume the file is in the same location as this file (akg.py)
        script_dir = os.path.dirname(os.path.abspath(__file__))
        full_path = os.path.join(script_dir, source)
        with open(full_path, 'r') as file:
            next(file)  
            lines = file.readlines()
            self._lines = [line.upper() for line in lines]
        # populate the ensemble ID dict
        for line in self._lines:
            sline = line.split() # split on all whitespace
            if len(sline) > 2: # (the second entry on the line is the ensemble ID for it to be useful)
                hgnc_ID = sline[0].strip() # first entry needs to be hgnc to be useful. See issue 17.
                if hgnc_ID.startswith('HGNC'):
                    # loop through all the whitespace-separated components and add them to the dict
                    for id in sline[1:]:
                        id = id.strip().upper()
                        if id.startswith('ENS'): # really is an ensemble ID
                            # for consistent behaviour with the original, don't overwrite 
                            # values with ones that are later on in the gene_ids.txt data
                            if id not in self._ens:
                                self._ens[id] = hgnc_ID
                        else:
                            if id not in self._oth:
                                self._oth[id] = hgnc_ID
        logging.info(f'ensemble_id to hgnc dict has {len(self._ens)} entries')
        logging.info(f'symbol to hgnc dict has {len(self._symbol_to_hgnc)} entries')
        logging.info(f'other_id to hgnc dict has {len(self._oth)} entries')

    def get_gene_id(self, gene_name:str):
        # Remove 'hp_' and variant info to help matching process
        if gene_name.startswith('hp_'):
            gene_name = gene_name[3:]
        if '_' in gene_name[-5:]:
            gene_name = gene_name[:gene_name.rfind('_', len(gene_name) - 5)]    
        if '.' in gene_name:
            gene_name = gene_name.split('.')[0]

        u_gene_name = gene_name.upper()
        if u_gene_name.startswith('ENS'):
            if self._ETH:
                # in theory this should be fastest
                hgnc_lookup = self._ensembl_to_hgnc.get(u_gene_name, None)
                if hgnc_lookup is not None:
                    return hgnc_lookup

            direct_lookup = self._ens.get(u_gene_name, None)
            if direct_lookup is not None:
                return direct_lookup

            # try with strip the ensemble id version number
            direct_lookup = self._ens.get(u_gene_name.split('.')[0], None)
            if direct_lookup is not None:
                print(f"HGNC ID found for ensemble ID {u_gene_name}, version omitted")
                return direct_lookup
        # if we get here, it is not an ensemble ID, so try the other one
        hgnc_direct_lookup = self._symbol_to_hgnc.get(u_gene_name, None)
        if hgnc_direct_lookup is not None:
            return hgnc_direct_lookup

        direct_lookup = self._oth.get(u_gene_name, None)
        if direct_lookup is not None:
            logging.debug(f"HGNC ID found for other ID {u_gene_name}")
            return direct_lookup

        for line in self._lines:
            if u_gene_name in line: # .upper():
                logging.debug(f"{gene_name} HGNC ID found by brute-force search")
                return line.split('\t')[0]
            if u_gene_name.split('.')[0] in line: # .upper():
                logging.debug(f"{gene_name} HGNC ID found by brute-force search, first component only")
                return line.split('\t')[0]
        # for optimisation, really useful to know what is not found
        logging.debug(f"HGNC ID not found for {gene_name}")
        return ''
    
    def _setup_hgnc_mapping(self, hgnc_file:str):
        """
        set up a lookup table based on the complete data provided by HGNC
        """
        self._ensembl_to_hgnc = {}
        self._symbol_to_hgnc = {}
        # simple flag to check this is useable
        self._ETH = False

        try:
            with open(hgnc_file, 'r', encoding='utf-8') as f:
                data = json.load(f)

            # Get the list of gene documents
            gene_docs = data.get('response', {}).get('docs', [])

            if not gene_docs:
                logging.warning("No gene documents found in the JSON file.")
                return {}

            # Iterate over each gene in the dataset
            for gene in gene_docs:
                # Check if the gene has an Ensembl ID
                if 'ensembl_gene_id' in gene:
                    ensembl_id = gene['ensembl_gene_id']
                    hgnc_id = gene.get('hgnc_id')
                    hgnc_symbol = gene.get('symbol')

                    if ensembl_id:
                        if hgnc_id:
                            self._ensembl_to_hgnc[ensembl_id] = hgnc_id
                            if hgnc_symbol:
                                self._symbol_to_hgnc[hgnc_symbol] = hgnc_id

        except FileNotFoundError:
            logging.error(f"Error: The file '{hgnc_file}' was not found.")
            return
        # If we get here, the mapping is set up
        self._ETH = True

        logging.info(f"HGNC mapping set up with {len(self._ensembl_to_hgnc)} entries")

# define the namespaces used in the RDF data
BIOLINK = Namespace("https://w3id.org/biolink/vocab/")
ENSEMBL = Namespace("http://identifiers.org/ensembl/")
NCBIGENE = Namespace("http://identifiers.org/ncbigene/")
RDFS = Namespace("http://www.w3.org/2000/01/rdf-schema#")
RDF = Namespace("http://www.w3.org/1999/02/22-rdf-syntax-ns#")
SCHEMA = Namespace("https://schema.org/")
# next one is not https.
EDAM = Namespace("http://edamontology.org/")
DOI = Namespace("https://doi.org/")
DCT = Namespace("http://purl.org/dc/terms/")
PMC = Namespace("https://pubmed.ncbi.nlm.nih.gov/")
OWL = Namespace("http://www.w3.org/2002/07/owl#")
MONARCH = Namespace("https://monarchinitiative.org/")
URN = Namespace("urn:uuid:")

def load_graph(filename: str) -> Graph:
    """
    Load a knowledge graph from an nt format file
    :param filename: Path to the RDF graph file in NT format
    :return: An rdflib Graph object containing the loaded RDF data
    """
    # Create a new RDF graph
    g = Graph()
    with open(filename, "rb") as f:
        g.parse(f, format="nt")
    return g


# run the tests on the command line with 
# pytest -v akg.py
# (if you don't name the file, pytest will try to discover all in the current directory)
# or for a specific test:
# pytest -v akg.py::test_ens_1
# to see the timing data and anything else that is being printed out, use -s:
# pytest -v -s akg.py
def test_sanity():
    """
    function test_sanity - checks the testing is working
    """
    

def test_original_get_gene_id():
    """
    Just run the original with timing. 

    Test the function twice: the optimised version will cache the require data, 
    so the speed improvement will come on the second call
    
    """
    not_found = 'GO:0006952'

    start = time.perf_counter()

    test_count = 100.
    for i in 1,test_count:
        r1 = get_gene_id(not_found)
        assert r1 == ''

    end = time.perf_counter()

    test_elapsed = end-start
    test_mean = test_elapsed/test_count

    print(f"Elapsed time for {test_count} calls: {test_elapsed:.4f} seconds (mean={test_mean:.4f})")


def test_create_GIDS():
    mygids = GeneIdStore()

def test_new_get_gene_id():
    not_found = 'GO:0006952'


    mygids = GeneIdStore()

    start = time.perf_counter()

    test_count = 100.
    for i in 1,test_count:
        r1 = mygids.get_gene_id(not_found)
        assert r1 == ''

    end = time.perf_counter()

    test_elapsed = end-start
    test_mean = test_elapsed/test_count

    print(f"GeneIdStore version, elapsed time for {test_count} calls: {test_elapsed:.4f} seconds (mean={test_mean:.4f})")

def compare_for_test(gene:str, response:str, timing:bool=True, gids:GeneIdStore=None) -> GeneIdStore:
    """
    Compare two versions of lookup for a single gene, with timing if necessary
    Facilitates wider ranging tests

    Parameters:
        gene:str                the gene to search for
        response:str            the expected response
        timing:bool=True        set to true if timing output needed
        gids:GeneIdStore=None   the GeneIdStore to use. If None, one will be created

    Return value:
        The GeneIdStore used in this comparison. Useful to speed up repeat trials.
    """
    mygids = gids if gids is not None else GeneIdStore()

    start = time.perf_counter()

    r1 = get_gene_id(gene)
    assert r1 == response

    end = time.perf_counter()

    print(f"Original version, elapsed time for {gene} search: {end-start:.4f} seconds")

    start = time.perf_counter()

    r1 = mygids.get_gene_id(gene)
    assert r1 == response
    end = time.perf_counter()

    print(f"GeneIdStore version, elapsed time for {gene} search: {end-start:.4f} seconds")
    return mygids

def test_ens_1():
    """
    confirm consistent response for an input of type ENS...
    choose a gene that is low-down the file for the timing test
    file 'maketests.sh' generated these test lines
    """

    mygids = compare_for_test('ENSG00000198888','HGNC:7455')
    mygids = compare_for_test('ENSG00000198763','HGNC:7456',gids=mygids)
    mygids = compare_for_test('ENSG00000198804','HGNC:7419',gids=mygids)
    mygids = compare_for_test('ENSG00000198712','HGNC:7421',gids=mygids)
    mygids = compare_for_test('ENSG00000228253','HGNC:7415',gids=mygids)
    mygids = compare_for_test('ENSG00000198899','HGNC:7414',gids=mygids)
    mygids = compare_for_test('ENSG00000198938','HGNC:7422',gids=mygids)
    mygids = compare_for_test('ENSG00000198840','HGNC:7458',gids=mygids)
    mygids = compare_for_test('ENSG00000212907','HGNC:7460',gids=mygids)
    mygids = compare_for_test('ENSG00000198886','HGNC:7459',gids=mygids)
    mygids = compare_for_test('ENSG00000198786','HGNC:7461',gids=mygids)
    mygids = compare_for_test('ENSG00000198695','HGNC:7462',gids=mygids)
    mygids = compare_for_test('ENSG00000198727','HGNC:7427',gids=mygids)
    mygids = compare_for_test('ENSG00000274847','HGNC:31102',gids=mygids)
    mygids = compare_for_test('ENSG00000291368','HGNC:126',gids=mygids)
    mygids = compare_for_test('ENSG00000291420','HGNC:144',gids=mygids)
    mygids = compare_for_test('ENSG00000288204','HGNC:5017',gids=mygids)
    mygids = compare_for_test('ENSG00000291420','HGNC:144',gids=mygids)
    mygids = compare_for_test('ENSG00000288204','HGNC:5017',gids=mygids)
    mygids = compare_for_test('ENSG00000291420','HGNC:144',gids=mygids)
    mygids = compare_for_test('ENSG00000291421','HGNC:29279',gids=mygids)
    mygids = compare_for_test('ENSG00000288499','HGNC:22140',gids=mygids)
    mygids = compare_for_test('ENSG00000263150','HGNC:15311',gids=mygids)
    mygids = compare_for_test('ENSG00000262851','HGNC:15296',gids=mygids)
    mygids = compare_for_test('ENSG00000261897','HGNC:15297',gids=mygids)
    mygids = compare_for_test('ENSG00000262784','HGNC:14821',gids=mygids)
    mygids = compare_for_test('ENSG00000262611','HGNC:14824',gids=mygids)
    mygids = compare_for_test('ENSG00000262755','HGNC:15313',gids=mygids)
    mygids = compare_for_test('ENSG00000263328','HGNC:14831',gids=mygids)
    mygids = compare_for_test('ENSG00000262796','HGNC:14855',gids=mygids)
    mygids = compare_for_test('ENSG00000262315','HGNC:27538',gids=mygids)
    mygids = compare_for_test('ENSG00000281038','HGNC:29166',gids=mygids)
    mygids = compare_for_test('ENSG00000288269','HGNC:4192',gids=mygids)
    mygids = compare_for_test('ENSG00000288213','HGNC:28007',gids=mygids)
    mygids = compare_for_test('ENSG00000288186','HGNC:16813',gids=mygids)
    mygids = compare_for_test('ENSG00000281934','HGNC:14086',gids=mygids)
    mygids = compare_for_test('ENSG00000282175','HGNC:29295',gids=mygids)
    mygids = compare_for_test('ENSG00000282817','HGNC:28841',gids=mygids)
    mygids = compare_for_test('ENSG00000282584','HGNC:31971',gids=mygids)
    mygids = compare_for_test('ENSG00000282663','HGNC:27997',gids=mygids)
    mygids = compare_for_test('ENSG00000279195','HGNC:28415',gids=mygids)
    mygids = compare_for_test('ENSG00000282119','HGNC:30583',gids=mygids)
    mygids = compare_for_test('ENSG00000282437','HGNC:51234',gids=mygids)
    mygids = compare_for_test('ENSG00000282559','HGNC:51235',gids=mygids)
    mygids = compare_for_test('ENSG00000282566','HGNC:49179',gids=mygids)
    mygids = compare_for_test('ENSG00000282530','HGNC:48813',gids=mygids)
    mygids = compare_for_test('ENSG00000281987','HGNC:49178',gids=mygids)
    mygids = compare_for_test('ENSG00000282095','HGNC:51333',gids=mygids)
    mygids = compare_for_test('ENSG00000261958','HGNC:15319',gids=mygids)
    mygids = compare_for_test('ENSG00000262191','HGNC:31940',gids=mygids)
    mygids = compare_for_test('ENSG00000282298','HGNC:27996',gids=mygids)
    mygids = compare_for_test('ENSG00000282741','HGNC:13262',gids=mygids)
    mygids = compare_for_test('ENSG00000262647','HGNC:15322',gids=mygids)
    mygids = compare_for_test('ENSG00000282212','HGNC:30693',gids=mygids)
    mygids = compare_for_test('ENSG00000282424','HGNC:27995',gids=mygids)
    mygids = compare_for_test('ENSG00000281107','HGNC:15287',gids=mygids)
    mygids = compare_for_test('ENSG00000282583','HGNC:24074',gids=mygids)
    mygids = compare_for_test('ENSG00000282125','HGNC:49193',gids=mygids)
    mygids = compare_for_test('ENSG00000293551','HGNC:34393',gids=mygids)
    mygids = compare_for_test('ENSG00000291381','HGNC:26604',gids=mygids)
    mygids = compare_for_test('ENSG00000288263','HGNC:10013',gids=mygids)
    mygids = compare_for_test('ENSG00000291382','HGNC:28127',gids=mygids)
    mygids = compare_for_test('ENSG00000291375','HGNC:29249',gids=mygids)
    mygids = compare_for_test('ENSG00000291379','HGNC:30232',gids=mygids)
    mygids = compare_for_test('ENSG00000291401','HGNC:28026',gids=mygids)
    mygids = compare_for_test('ENSG00000291380','HGNC:25528',gids=mygids)
    mygids = compare_for_test('ENSG00000291387','HGNC:18341',gids=mygids)
    mygids = compare_for_test('ENSG00000291426','HGNC:16476',gids=mygids)

def test_ens_2():
    """
    As test_ens_1 but for the last 100. Takes longer, they're at the end of the file 
    file 'makemoretests.sh' generated these test lines
    """
    mygids = compare_for_test('ENSG00000244462','HGNC:9898')
    mygids = compare_for_test('ENSG00000108684','HGNC:99',gids=mygids)
    mygids = compare_for_test('ENSG00000171791','HGNC:990',gids=mygids)
    mygids = compare_for_test('ENSG00000102317','HGNC:9900',gids=mygids)
    mygids = compare_for_test('ENSG00000173933','HGNC:9901',gids=mygids)
    mygids = compare_for_test('ENSG00000003756','HGNC:9902',gids=mygids)
    mygids = compare_for_test('ENSG00000004534','HGNC:9903',gids=mygids)
    mygids = compare_for_test('ENSG00000076053','HGNC:9904',gids=mygids)
    mygids = compare_for_test('ENSG00000265241','HGNC:9905',gids=mygids)
    mygids = compare_for_test('ENSG00000100320','HGNC:9906',gids=mygids)
    mygids = compare_for_test('ENSG00000277564','HGNC:9906',gids=mygids)
    mygids = compare_for_test('ENSG00000153250','HGNC:9907',gids=mygids)
    mygids = compare_for_test('ENSG00000225422','HGNC:9908',gids=mygids)
    mygids = compare_for_test('ENSG00000076067','HGNC:9909',gids=mygids)
    mygids = compare_for_test('ENSG00000140379','HGNC:991',gids=mygids)
    mygids = compare_for_test('ENSG00000147274','HGNC:9910',gids=mygids)
    mygids = compare_for_test('ENSG00000216835','HGNC:9911',gids=mygids)
    mygids = compare_for_test('ENSG00000234414','HGNC:9912',gids=mygids)
    mygids = compare_for_test('ENSG00000169811','HGNC:9916',gids=mygids)
    mygids = compare_for_test('ENSG00000226092','HGNC:9917',gids=mygids)
    mygids = compare_for_test('ENSG00000224657','HGNC:9918',gids=mygids)
    mygids = compare_for_test('ENSG00000114115','HGNC:9919',gids=mygids)
    mygids = compare_for_test('ENSG00000171552','HGNC:992',gids=mygids)
    mygids = compare_for_test('ENSG00000114113','HGNC:9920',gids=mygids)
    mygids = compare_for_test('ENSG00000265203','HGNC:9921',gids=mygids)
    mygids = compare_for_test('ENSG00000138207','HGNC:9922',gids=mygids)
    mygids = compare_for_test('ENSG00000234159','HGNC:9923',gids=mygids)
    mygids = compare_for_test('ENSG00000100387','HGNC:9928',gids=mygids)
    mygids = compare_for_test('ENSG00000137875','HGNC:993',gids=mygids)
    mygids = compare_for_test('ENSG00000049449','HGNC:9934',gids=mygids)
    mygids = compare_for_test('ENSG00000117906','HGNC:9935',gids=mygids)
    mygids = compare_for_test('ENSG00000102076','HGNC:9936',gids=mygids)
    mygids = compare_for_test('ENSG00000109047','HGNC:9937',gids=mygids)
    mygids = compare_for_test('ENSG00000153094','HGNC:994',gids=mygids)
    mygids = compare_for_test('ENSG00000135437','HGNC:9940',gids=mygids)
    mygids = compare_for_test('ENSG00000112619','HGNC:9942',gids=mygids)
    mygids = compare_for_test('ENSG00000137710','HGNC:9944',gids=mygids)
    mygids = compare_for_test('ENSG00000255387','HGNC:9945',gids=mygids)
    mygids = compare_for_test('ENSG00000223391','HGNC:9946',gids=mygids)
    mygids = compare_for_test('ENSG00000004700','HGNC:9948',gids=mygids)
    mygids = compare_for_test('ENSG00000160957','HGNC:9949',gids=mygids)
    mygids = compare_for_test('ENSG00000129473','HGNC:995',gids=mygids)
    mygids = compare_for_test('ENSG00000108469','HGNC:9950',gids=mygids)
    mygids = compare_for_test('ENSG00000115386','HGNC:9951',gids=mygids)
    mygids = compare_for_test('ENSG00000172023','HGNC:9952',gids=mygids)
    mygids = compare_for_test('ENSG00000204787','HGNC:9953',gids=mygids)
    mygids = compare_for_test('ENSG00000162924','HGNC:9954',gids=mygids)
    mygids = compare_for_test('ENSG00000173039','HGNC:9955',gids=mygids)
    mygids = compare_for_test('ENSG00000104856','HGNC:9956',gids=mygids)
    mygids = compare_for_test('ENSG00000189056','HGNC:9957',gids=mygids)
    mygids = compare_for_test('ENSG00000143839','HGNC:9958',gids=mygids)
    mygids = compare_for_test('ENSG00000102032','HGNC:9959',gids=mygids)
    mygids = compare_for_test('ENSG00000175730','HGNC:996',gids=mygids)
    mygids = compare_for_test('ENSG00000005007','HGNC:9962',gids=mygids)
    mygids = compare_for_test('ENSG00000169891','HGNC:9963',gids=mygids)
    mygids = compare_for_test('ENSG00000133884','HGNC:9964',gids=mygids)
    mygids = compare_for_test('ENSG00000142599','HGNC:9965',gids=mygids)
    mygids = compare_for_test('ENSG00000084093','HGNC:9966',gids=mygids)
    mygids = compare_for_test('ENSG00000165731','HGNC:9967',gids=mygids)
    mygids = compare_for_test('ENSG00000009413','HGNC:9968',gids=mygids)
    mygids = compare_for_test('ENSG00000035928','HGNC:9969',gids=mygids)
    mygids = compare_for_test('ENSG00000236616','HGNC:997',gids=mygids)
    mygids = compare_for_test('ENSG00000049541','HGNC:9970',gids=mygids)
    mygids = compare_for_test('ENSG00000133119','HGNC:9971',gids=mygids)
    mygids = compare_for_test('ENSG00000163918','HGNC:9972',gids=mygids)
    mygids = compare_for_test('ENSG00000111445','HGNC:9973',gids=mygids)
    mygids = compare_for_test('ENSG00000169733','HGNC:9974',gids=mygids)
    mygids = compare_for_test('ENSG00000204713','HGNC:9975',gids=mygids)
    mygids = compare_for_test('ENSG00000234495','HGNC:9975',gids=mygids)
    mygids = compare_for_test('ENSG00000229006','HGNC:9975',gids=mygids)
    mygids = compare_for_test('ENSG00000233948','HGNC:9975',gids=mygids)
    mygids = compare_for_test('ENSG00000215641','HGNC:9975',gids=mygids)
    mygids = compare_for_test('ENSG00000237462','HGNC:9975',gids=mygids)
    mygids = compare_for_test('ENSG00000237071','HGNC:9975',gids=mygids)
    mygids = compare_for_test('ENSG00000204977','HGNC:9976',gids=mygids)
    mygids = compare_for_test('ENSG00000128250','HGNC:9977',gids=mygids)
    mygids = compare_for_test('ENSG00000225465','HGNC:9978',gids=mygids)
    mygids = compare_for_test('ENSG00000128253','HGNC:9979',gids=mygids)
    mygids = compare_for_test('ENSG00000069399','HGNC:998',gids=mygids)
    mygids = compare_for_test('ENSG00000128276','HGNC:9980',gids=mygids)
    mygids = compare_for_test('ENSG00000205853','HGNC:9981',gids=mygids)
    mygids = compare_for_test('ENSG00000288283','HGNC:9982',gids=mygids)
    mygids = compare_for_test('ENSG00000132005','HGNC:9982',gids=mygids)
    mygids = compare_for_test('ENSG00000087903','HGNC:9983',gids=mygids)
    mygids = compare_for_test('ENSG00000080298','HGNC:9984',gids=mygids)
    mygids = compare_for_test('ENSG00000111783','HGNC:9985',gids=mygids)
    mygids = compare_for_test('ENSG00000143390','HGNC:9986',gids=mygids)
    mygids = compare_for_test('ENSG00000064490','HGNC:9987',gids=mygids)
    mygids = compare_for_test('ENSG00000133111','HGNC:9988',gids=mygids)
    mygids = compare_for_test('ENSG00000130988','HGNC:9989',gids=mygids)
    mygids = compare_for_test('ENSG00000148604','HGNC:9990',gids=mygids)
    mygids = compare_for_test('ENSG00000090104','HGNC:9991',gids=mygids)
    mygids = compare_for_test('ENSG00000148908','HGNC:9992',gids=mygids)
    mygids = compare_for_test('ENSG00000076344','HGNC:9993',gids=mygids)
    mygids = compare_for_test('ENSG00000159788','HGNC:9994',gids=mygids)
    mygids = compare_for_test('ENSG00000127074','HGNC:9995',gids=mygids)
    mygids = compare_for_test('ENSG00000169220','HGNC:9996',gids=mygids)
    mygids = compare_for_test('ENSG00000143333','HGNC:9997',gids=mygids)
    mygids = compare_for_test('ENSG00000116741','HGNC:9998',gids=mygids)
    mygids = compare_for_test('ENSG00000138835','HGNC:9999',gids=mygids)

def test_grin2b():
    gb  = 'GRIN2B'

    mygids = GeneIdStore()

    r1 = mygids.get_gene_id(gb)

    print(f"found: {r1}")

def test_piwil1():
    gb  = 'PIWIL1'

    mygids = GeneIdStore()

    r1 = mygids.get_gene_id(gb)

    print(f"found: {r1}")

if __name__ == "__main__":
    test_grin2b()